<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>ScrollSmoother/ScrollTrigger - Clamp</title>
    <link rel='stylesheet' href='https://codepen.io/GreenSock/pen/gOWxmWG.css'>
    <link rel="stylesheet" href="./style.css">

</head>

<body>
    <!-- partial:index.partial.html -->
    <div id="smooth-wrapper">
        <div id="smooth-content">
            <header>
                <div class="logo" style="width: 250px; height: 50px;">
                    <img src="./img/lachiquitanaLogo.png" alt="">
                </div>
                <nav>
                    <ul role="list">
                        <li><a
                                href="https://greensock.com/forums/topic/36177-scrollsmoother-data-speed-and-firstlast-folds/#comment-183450">about</a>
                        </li>
                    </ul>
                </nav>
            </header>

            <div class="lazo-decorativo">
                <img id="mapa-animado" src="./img/lachiquitanaLogo.png" alt="Lazo decorativo">
            </div>

            <section class="hero pad-l">
                <div class="heading" id="heading-hero">
                    <div class="pin">
                        <h1>
                            <span class="clamp">Vive
                                <svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 842.14 500">
                                    <path class="draw"
                                        d="M336.2,130.05C261.69,118,16.52,122,20.65,244.29c4.17,123,484.3,299.8,734.57,108.37,244-186.65-337.91-311-546.54-268.47"
                                        fill="none" stroke="#7bb661" stroke-miterlimit="10" stroke-width="12" />
                                </svg>
                            </span>
                            <span class="yt">La Chiquitanía</span>
                        </h1>
                        <div class="en-espana" id="en-espana">En España.</div>
                    </div>
                </div>
                <div class="images">
                    <img data-speed="clamp(2.4)"
                        src='https://images.unsplash.com/photo-1604074309478-a25167bd0306?w=1600&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8Ym9saXZpYSUyMHNhbnRhJTIwY3J1enxlbnwwfHwwfHx8MA%3D%3D'
                        alt=''>
                    <img data-speed="clamp(1.8)"
                        src='https://plus.unsplash.com/premium_photo-1677797464101-9ff9bb0ae638?w=1600&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NXx8Ym9saXZpYSUyMHNhbnRhJTIwY3J1enxlbnwwfHwwfHx8MA%3D%3D'
                        alt=''>
                    <img data-speed="clamp(2.2)"
                        src='https://plus.unsplash.com/premium_photo-1680101647516-98cf43a797d0?w=1600&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTd8fGJvbGl2aWElMjBzYW50YSUyMGNydXp8ZW58MHx8MHx8fDA%3D'
                        alt=''>
                    <img data-speed="clamp(1.5)"
                        src='https://images.unsplash.com/photo-1565493774908-90717173f1a4?w=1600&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTl8fGJvbGl2aWElMjBzYW50YSUyMGNydXp8ZW58MHx8MHx8fDA%3D'
                        alt=''>
                </div>
                <div class="scroll-down-indicator">
                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#4e7c59" stroke-width="2.5"
                        stroke-linecap="round" stroke-linejoin="round"
                        class="feather feather-chevron-down animated-arrow">
                        <polyline points="6 9 12 15 18 9" />
                    </svg>
                </div>



            </section>

            <div class="about-hero" id="about-hero">
                <h2 class="about-title">¿Qué es la Chiquitania?</h2>
                <p class="about-desc">
                    Un paraíso natural y cultural en el corazón de Bolivia.<br>
                    <span class="about-strong">Tierra de tradiciones, sabores únicos y paisajes que enamoran.</span>
                </p>
            </div>

            <div class="experiencia-hero" id="experiencia-hero">
                <h2 class="exp-title">Vívelo en primera persona</h2>
                <p class="exp-desc">
                    Recorre sus senderos, prueba su gastronomía y déjate llevar por la calidez de su gente.<br>
                    <span class="exp-highlight">¡La aventura te espera!</span>
                </p>
            </div>

            <section class="spacer">
            </section>
        </div>
    </div>

    <script src="./gsap/gsap.min.js"></script>
    <script src="./gsap/ScrollTrigger.min.js"></script>
    <script src="./gsap/ScrollSmoother.min.js"></script>
    <script src="./gsap/DrawSVGPlugin.min.js"></script>
    <script type="module" src="./script.js"></script>
    <script>
        (function initAnimation() {
            let smoother;

            // Registrar plugins
            gsap.registerPlugin(ScrollTrigger, ScrollSmoother, DrawSVGPlugin);

            // Inicializar ScrollSmoother
            function initSmoother() {
                smoother = ScrollSmoother.create({
                    wrapper: "#smooth-wrapper",
                    content: "#smooth-content",
                    smooth: 1.5,
                    normalizeScroll: true,
                    ignoreMobileResize: true,
                    effects: true
                });
            }

            // Configurar animaciones
            function setupAnimations() {
                // Animación del mapa
                gsap.to("#mapa-animado", {
                    scrollTrigger: {
                        trigger: ".hero",
                        start: "top top",
                        end: "bottom top",
                        scrub: 1,
                        invalidateOnRefresh: true
                    },
                    scale: 1.5,
                    transformOrigin: "center center"
                });

                // Animación del título con mejor control
                gsap.to("#heading-hero", {
                    y: 180,
                    scrollTrigger: {
                        trigger: ".hero",
                        start: "top top",
                        end: "center top",
                        scrub: 1,
                        invalidateOnRefresh: true
                    }
                });

                // Pin del mapa con mejor control
                ScrollTrigger.create({
                    trigger: ".hero",
                    start: "center top",
                    end: "bottom top",
                    pin: "#mapa-animado",
                    pinSpacing: false,
                    invalidateOnRefresh: true
                });

                // Control de visibilidad "En España"
                const enEspanaElement = document.getElementById('en-espana');
                ScrollTrigger.create({
                    trigger: ".hero",
                    start: "center top",
                    end: "bottom top",
                    onEnter: () => enEspanaElement?.classList.add('visible'),
                    onLeaveBack: () => enEspanaElement?.classList.remove('visible'),
                    invalidateOnRefresh: true
                });

                // Animaciones de secciones con mejor rendimiento
                const sections = [".about-hero", ".experiencia-hero"];
                sections.forEach((section, index) => {
                    gsap.fromTo(section,
                        {
                            opacity: 0,
                            y: 50,
                            scale: 0.95
                        },
                        {
                            scrollTrigger: {
                                trigger: section,
                                start: "top 80%",
                                toggleActions: "play none none none",
                                markers: true // Temporal para debug
                            },
                            opacity: 1,
                            y: 0,
                            scale: 1,
                            duration: 1.2,
                            ease: "power3.out",
                            delay: index * 0.3
                        }
                    );
                });
            }

            // Inicialización cuando el DOM está listo
            function init() {
                try {
                    initSmoother();
                    setupAnimations();

                    // Manejar redimensionamiento
                    let resizeTimeout;
                    window.addEventListener('resize', () => {
                        clearTimeout(resizeTimeout);
                        resizeTimeout = setTimeout(() => {
                            ScrollTrigger.refresh();
                        }, 250);
                    });
                } catch (error) {
                    console.error('Error initializing animations:', error);
                }
            }

            // Asegurar que GSAP está disponible
            if (window.gsap && window.ScrollTrigger) {
                init();
            } else {
                console.error('GSAP or ScrollTrigger not loaded');
            }

            // Limpieza al desmontar
            return () => {
                ScrollTrigger.getAll().forEach(st => st.kill());
                smoother && smoother.kill();
            };
        })();
    </script>

</body>

</html>
