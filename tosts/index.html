<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="La Chiquitana ofrece salteñas bolivianas hechas con receta tradicional. Jugosas, auténticas y con el sabor casero de siempre.">
    <title>Salteñas La Chiquitana</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="smooth-wrapper">
        <div id="smooth-content">
            <header>
                <img src="./img/lachiquitanaLogo.png" height="75px" width="75px" alt="">
                <nav>
                    <ul role="list">
                        <li><a
                                href="https://greensock.com/forums/topic/36177-scrollsmoother-data-speed-and-firstlast-folds/#comment-183450">about</a>
                        </li>
                    </ul>
                </nav>
            </header>

            <section class="hero pad-l">
                <div class="heading">
                    <div class="pin">
                        <h1><span class="clamp">Vive
                                <svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 842.14 500">
                                    <path class="draw"
                                        d="M336.2,130.05C261.69,118,16.52,122,20.65,244.29c4.17,123,484.3,299.8,734.57,108.37,244-186.65-337.91-311-546.54-268.47"
                                        fill="none" stroke="#8486aa" stroke-miterlimit="10" stroke-width="8" />
                                </svg>
                            </span><span class="yt">La Chiquitana</span></h1>
                    </div>
                </div>                <div class="images">
                    <img data-speed="1.2"
                        src='https://images.unsplash.com/photo-1530569673472-307dc017a82d?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwzMjM4NDZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2ODM2NTUwMDA&ixlib=rb-4.0.3&q=80&w=400'
                        alt=''>
                    <img data-speed="0.8"
                        src='https://images.unsplash.com/photo-1439853949127-fa647821eba0?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwzMjM4NDZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2ODM2NTQ5Njk&ixlib=rb-4.0.3&q=80&w=400'
                        alt=''>
                    <img data-speed="1.0"
                        src='https://images.unsplash.com/photo-1551376347-075b0121a65b?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwzMjM4NDZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2ODM2NTQ5MTE&ixlib=rb-4.0.3&q=80&w=400'
                        alt=''>
                    <img data-speed="0.6"
                        src='https://images.unsplash.com/photo-1500817487388-039e623edc21?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwzMjM4NDZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2ODM2NTQ5MTE&ixlib=rb-4.0.3&q=80&w=400'
                        alt=''>
                </div>
            </section>

            <section class="spacer">
            </section>
        </div>
    </div>
    <script src="./gsap/gsap.min.js"></script>
    <script src="./gsap/ScrollTrigger.min.js"></script>
    <script src="./gsap/ScrollSmoother.min.js"></script>
    <script src="./gsap/DrawSVGPlugin.min.js"></script>
    <script type="module" src="./script.js"></script>
    <script>
        (function initAnimation() {
            let smoother;

            // Registrar plugins
            gsap.registerPlugin(ScrollTrigger, ScrollSmoother, DrawSVGPlugin);

            // Detectar si es dispositivo móvil
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

            // Inicializar ScrollSmoother con configuración adaptativa
            function initSmoother() {
                // Ajustar velocidades de las imágenes según el dispositivo
                document.querySelectorAll('.images img').forEach(img => {
                    // En móvil, establecemos velocidades fijas más bajas
                    const speed = isMobile ? 0.3 : parseFloat(img.getAttribute('data-speed'));
                    img.setAttribute('data-speed', speed.toString());
                });

                smoother = ScrollSmoother.create({
                    wrapper: "#smooth-wrapper",
                    content: "#smooth-content",
                    smooth: isMobile ? 0.3 : 1.5, // Reducir aún más en móviles
                    normalizeScroll: false,
                    ignoreMobileResize: true,
                    effects: false, // Desactivar efectos por defecto
                    smoothTouch: 0.05, // Reducir suavizado touch
                    preventDefault: true,
                    renderGlare: false,
                    touchResistance: 0.75, // Añadir resistencia al touch
                    lockAxis: true
                });

                if (isMobile) {
                    // Desactivar efectos completamente en móvil
                    smoother.effects(false);
                    
                    // Mejorar el rendimiento en móviles
                    gsap.ticker.lagSmoothing(0);
                    
                    // Configurar ScrollTrigger para mejor rendimiento en móvil
                    ScrollTrigger.config({
                        autoRefreshEvents: "visibilitychange,DOMContentLoaded,load",
                        syncInterval: 60, // Reducir la frecuencia de sincronización
                        ignoreMobileResize: true,
                        fastScrollEnd: true // Terminar el scroll rápidamente
                    });

                    // Añadir un debounce al scroll para evitar actualizaciones excesivas
                    let scrollTimeout;
                    window.addEventListener('scroll', () => {
                        clearTimeout(scrollTimeout);
                        scrollTimeout = setTimeout(() => {
                            ScrollTrigger.refresh(true);
                        }, 150);
                    }, { passive: true });
                }

                // Manejar la actualización de scroll de manera más eficiente
                ScrollTrigger.addEventListener("refresh", () => {
                    requestAnimationFrame(() => {
                        smoother.update();
                    });
                });
            }

            // Configurar animaciones
            function setupAnimations() {
                // Configuración específica para móviles
                const config = {
                    scale: isMobile ? 1.1 : 1.5,
                    scrub: isMobile ? 0.3 : 1,
                    batchMax: isMobile ? 1 : 3, // Limitar el número de actualizaciones simultáneas en móvil
                };

                if (isMobile) {
                    // Batch todas las animaciones para mejor rendimiento
                    gsap.set(".images img", { willChange: "transform" });
                    ScrollTrigger.batch(".images img", {
                        batchMax: config.batchMax,
                        onEnter: batch => {
                            gsap.to(batch, {
                                autoAlpha: 1,
                                stagger: 0.15,
                                overwrite: true
                            });
                        }
                    });
                }

                // Resto de las animaciones...
                // Animación del mapa con configuración adaptativa
                gsap.to("#mapa-animado", {
                    scrollTrigger: {
                        trigger: ".hero",
                        start: "top top",
                        end: "bottom top",
                        scrub: config.scrub,
                        invalidateOnRefresh: true
                    },
                    scale: config.scale,
                    transformOrigin: "center center"
                });

                // Animación del título adaptada
                gsap.to("#heading-hero", {
                    y: isMobile ? 100 : 180,
                    scrollTrigger: {
                        trigger: ".hero",
                        start: "top top",
                        end: "center top",
                        scrub: config.scrub,
                        invalidateOnRefresh: true
                    }
                });

                // Pin del mapa con mejor control
                ScrollTrigger.create({
                    trigger: ".hero",
                    start: "center top",
                    end: "bottom top",
                    pin: "#mapa-animado",
                    pinSpacing: false,
                    invalidateOnRefresh: true
                });

                // Control de visibilidad "En España"
                const enEspanaElement = document.getElementById('en-espana');
                ScrollTrigger.create({
                    trigger: ".hero",
                    start: "center top",
                    end: "bottom top",
                    onEnter: () => enEspanaElement?.classList.add('visible'),
                    onLeaveBack: () => enEspanaElement?.classList.remove('visible'),
                    invalidateOnRefresh: true
                });

                // Animaciones de secciones con mejor rendimiento
                const sections = [".about-hero", ".experiencia-hero"];
                sections.forEach((section, index) => {
                    gsap.fromTo(section,
                        {
                            opacity: 0,
                            y: isMobile ? 25 : 50,
                            scale: 0.98
                        },
                        {
                            scrollTrigger: {
                                trigger: section,
                                start: "top 85%",
                                toggleActions: "play none none none"
                            },
                            opacity: 1,
                            y: 0,
                            scale: 1,
                            duration: isMobile ? 0.8 : 1.2,
                            ease: "power2.out",
                            delay: isMobile ? index * 0.2 : index * 0.3
                        }
                    );
                });

                // Mejorar el manejo del resize
                let resizeTimeout;
                window.addEventListener('resize', () => {
                    clearTimeout(resizeTimeout);
                    resizeTimeout = setTimeout(() => {
                        ScrollTrigger.refresh(true); // Force refresh
                    }, isMobile ? 100 : 250);
                });

                // Añadir listener para orientación en móviles
                if (isMobile) {
                    window.addEventListener('orientationchange', () => {
                        setTimeout(() => {
                            ScrollTrigger.refresh(true);
                        }, 200);
                    });
                }
            }

            // Inicialización cuando el DOM está listo
            function init() {
                try {
                    initSmoother();
                    setupAnimations();
                } catch (error) {
                    console.error('Error initializing animations:', error);
                }
            }

            // Asegurar que GSAP está disponible
            if (window.gsap && window.ScrollTrigger) {
                init();
            } else {
                console.error('GSAP or ScrollTrigger not loaded');
            }

            // Limpieza al desmontar
            return () => {
                ScrollTrigger.getAll().forEach(st => st.kill());
                smoother && smoother.kill();
            };
        })();
    </script>
</body>

</html>